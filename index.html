<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Driver Auth</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .container {
        max-width: 400px;
        margin-top: 100px;
      }
      .tab-content {
        padding: 20px;
        border: 1px solid #dee2e6;
        border-top: none;
        border-radius: 0 0 0.375rem 0.375rem;
      }
      #welcomeScreen {
        display: none;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container" id="authContainer">
      <ul class="nav nav-tabs" id="authTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="login-tab"
            data-bs-toggle="tab"
            data-bs-target="#login"
            type="button"
            role="tab"
          >
            Login
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="register-tab"
            data-bs-toggle="tab"
            data-bs-target="#register"
            type="button"
            role="tab"
          >
            Register
          </button>
        </li>
      </ul>
      <div class="tab-content bg-white">
        <div class="tab-pane fade show active" id="login" role="tabpanel">
          <form id="loginForm">
            <div class="mb-3">
              <label for="loginEmail" class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                id="loginEmail"
                required
              />
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="loginPassword"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
          </form>
        </div>
        <div class="tab-pane fade" id="register" role="tabpanel">
          <form id="registerForm">
            <div class="mb-3">
              <label for="firstName" class="form-label">First Name</label>
              <input type="text" class="form-control" id="firstName" required />
            </div>
            <div class="mb-3">
              <label for="lastName" class="form-label">Last Name</label>
              <input type="text" class="form-control" id="lastName" required />
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" required />
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="password"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary w-100">
              Register
            </button>
          </form>
        </div>
      </div>
    </div>
    <div class="container" id="welcomeScreen">
      <h2 id="welcomeMessage"></h2>
      <button class="btn btn-secondary" onclick="logout()">Logout</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const url =
        "https://script.google.com/macros/s/AKfycbxGUt3i_MdaapasDtSJdIi4nJpO_H0yOfgL12fraQjgsC-yZz9iRhXxoLkBsjwpWJEFQg/exec"; // Replace with deployed Google Apps Script Web app URL

      document
        .getElementById("registerForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const data = {
            firstName: document.getElementById("firstName").value,
            lastName: document.getElementById("lastName").value,
            email: document.getElementById("email").value,
            password: document.getElementById("password").value,
          };
          const response = await fetch(`${url}?action=register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          const result = await response.json();
          if (result.status === "success") {
            alert("Registration done!");
            // Switch to login tab
            const loginTab = new bootstrap.Tab(
              document.getElementById("login-tab")
            );
            loginTab.show();
            document.getElementById("registerForm").reset(); // Clear form
          } else {
            alert("Registration error");
          }
        });

      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("loginEmail").value;
          const password = document.getElementById("loginPassword").value;
          const response = await fetch(
            `${url}?action=login&email=${email}&password=${password}`
          );
          const result = await response.json();
          if (result.status === "success") {
            // Fetch first name from Google Sheet (requires modification in doGet)
            // For simplicity, we'll assume firstName is stored locally or passed back
            const firstName = document
              .getElementById("loginEmail")
              .value.split("@")[0]; // Placeholder: replace with actual firstName from server if modified
            document.getElementById(
              "welcomeMessage"
            ).textContent = `Welcome ${firstName}`;
            document.getElementById("authContainer").style.display = "none";
            document.getElementById("welcomeScreen").style.display = "block";
            document.getElementById("loginForm").reset(); // Clear form
          } else {
            alert("Invalid credentials");
          }
        });

      function logout() {
        document.getElementById("welcomeScreen").style.display = "none";
        document.getElementById("authContainer").style.display = "block";
        const loginTab = new bootstrap.Tab(
          document.getElementById("login-tab")
        );
        loginTab.show();
      }
    </script>
  </body>
</html>
